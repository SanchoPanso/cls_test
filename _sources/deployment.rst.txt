Разворачивание
==============

Model Storage
--------------

Ваша конфигурация представляет собой совокупность компонентов: 
Docker-контейнер с SSH сервером, Triton Server и FastAPI сервером. 
Ниже представлена детальная инструкция по развертыванию данного решения.

Клонирование репозитория
^^^^^^^^^^^^^^^^^^^^^^^^

Клонируйте ваш репозиторий с Dockerfile и остальными необходимыми файлами в вашу рабочую среду:

.. code-block:: bash

    git clone https://github.com/SanchoPanso/model_storage.git
    cd model_storage

Конфигурация .env файла
^^^^^^^^^^^^^^^^^^^^^^^

Убедитесь, что файл `.env` находится в корне вашего проекта и 
содержит нужные переменные окружения. 
Проверьте, чтобы значения в файле соответствовали 
вашим требованиям безопасности и конфиденциальности.

.. note::

    Скорее всего, ничего менять не нужно. Однако, могут возникнуть
    проблемы с доступом к файлам, созданным в volume из запущенного контейнера.
    Поэтому вам может понадобиться установить 
    номер пользователя USER_UID и номер группы USER_GID,
    равными значениям у вашего локального пользователя, которые можно найти командами:

    .. code-block:: bash

        id -u   # USER_UID
        id -g   # USER_GID


Запуск контейнера
^^^^^^^^^^^^^^^^^^^^^^^^

Используйте Docker Compose для сборки и запуска вашего контейнера:

.. code-block:: bash
    
    docker-compose up --build -d

Команда соберет образ и запустит контейнер на основе вашего docker-compose.yaml и Dockerfile. 

Проверка работы сервисов
^^^^^^^^^^^^^^^^^^^^^^^^

Проверка SSH
""""""""""""

После того как контейнер будет запущен, вы можете проверить SSH доступ:

.. code-block:: bash
    
    ssh user@0.0.0.0 -p 4000

Замените user, если вы использовали другое значение в вашем .env файле.
Также предоставьте пароль, записанный в том же .env файле.

Проверка FastAPI
""""""""""""""""

Откройте в браузере следующий URL для доступа к FastAPI серверу:

.. code-block:: bash
    
    http://localhost:8300/docs

Здесь вы сможете увидеть сваггер документацию вашего API.

.. note::

    Если вы работаете на удаленном компьютере с досупом по SSH, 
    используйте проброс порта на локальную машину,
    чтобы иметь доступ к сервису, в том числе и в браузере:

    .. code-block:: bash
    
        ssh -L 8300:localhost:8300 achernikov@88.146.116.23 -p 999 -i <path-to-your-private-key>
    

Проверка Triton Server
""""""""""""""""""""""

Для проверки сервера Triton убедитесь, что он доступен и работает, открыв в браузере:

.. code-block:: bash
    
    http://localhost:8100/v2/health/live

Это покажет, жив ли Triton server.

Остановка и очистка
^^^^^^^^^^^^^^^^^^^

Для остановки и удаления контейнера используйте следующую команду Docker Compose:

.. code-block:: bash
    
    docker-compose down

Это остановит и удалит все контейнеры, а также сеть, которые были созданы.


